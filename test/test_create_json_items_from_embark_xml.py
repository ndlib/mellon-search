#test_create_json_items_from_embark_xml.py 2/18/19 sm
''' test create_json_items_from_embark_xml.py '''

import sys
import json
import unittest
import csv
from xml.etree.ElementTree import ElementTree, tostring

# add parent directory to path
import os
import inspect
CURRENTDIR = os.path.dirname(os.path.abspath(inspect.getfile(inspect.currentframe())))
PARENTDIR = os.path.dirname(CURRENTDIR)
sys.path.insert(0, PARENTDIR)

import create_json_items_from_embark_xml

class Test(unittest.TestCase):
    ''' Class for test fixtures '''


    def test_write_json_output(self):
        ''' test writing json output '''
        json_data = '{"sample" : "test"}'
        create_json_items_from_embark_xml.write_json_output('.', 'test_write_json_output.json', json_data)
        with open('./test_write_json_output.json', 'r') as input_source:
            data = json.load(input_source)
        input_source.close()
        self.assertTrue(json_data == data)

    def test_everything(self):
        ''' run test on whole process, verifying expected results '''
        create_json_items_from_embark_xml.create_json_items_from_embark_xml('./objects 01_18_19.xml', 'temp/pnx', csv_output_root_directory='temp')

        #verify one csv
        with open('temp/1976.057/main.csv', 'r') as read_file:
            reader = csv.reader(read_file)
            lines = list(reader)
        expected_csv = [['Label', 'Description', 'License', 'Attribution', 'Sequence_filename', 'Sequence_label', 'Sequence_viewing_experience', 'unique_identifier', 'Metadata_label', 'Metadata_value'], ['ABSOLUTION UNDER FIRE', 'ABSOLUTION UNDER FIRE', '<a href="http://rightsstatements.org/vocab/NoC-US/1.0/" target="_blank">No Copyright - United States</a>', 'University of Notre Dame::Hesburgh Libraries::General', '', 'Sequence1', 'individuals', '1976.057', '', ''], ['', '', '', '', '', '', '', '', 'Accession Number', '1976.057'], ['', '', '', '', '', '', '', '', 'Repository', 'Snite'], ['', '', '', '', '', '', '', '', 'Creator', 'Paul Wood'], ['', '', '', '', '', '', '', '', 'Creation Date', '18910101'], ['', '', '', '', '', '', '', '', 'Display Date', '1891'], ['', '', '', '', '', '', '', '', 'Title', 'ABSOLUTION UNDER FIRE'], ['', '', '', '', '', '', '', '', 'Classification', 'Painting'], ['', '', '', '', '', '', '', '', 'Media', 'oil on canvas'], ['', '', '', '', '', '', '', '', 'Dimensions', '76 1/2 x 102 x 3 1/4 in. (194.31 x 259.08 x 8.26 cm)'], ['', '', '', '', '', '', '', '', 'Exhibition', 'Picturing History(09/01/94 - 12/01/94)\n'], ['', '', '', '', '', '', '', '', '', ''], ['', '', '', '', '', '', '', '', 'Bibliography', "Bilby, Joseph G., Remember Fontenoy!, Longstreet House, Highstown, NJ, 1995, 86\nBurger, John, Columbia, Pelowski, Alton J., Knights of Columbus, New Haven, CT, May 2015, 16-18\nCallaghan, James, Civil War, Miller, William J., Christopher M. Curran, Berryville, VA, August 1997, 26-33\nCarey, John E., The Civil War, The Washington Times, Saturday, Sept. 14, 1996, B3-not illustrated\nClark, Champ, The Civil War, Time Life Books, 1985, 100-101\nCorby, William, Memoirs of Chaplain Life, Kohl, Lawrence Frederick, Fordham University Press, Chicago, 1893, 385-387\nFaherty, S. J., William Barnaby, Catholic Chaplains in Blue and Gray, Jesuit Missouri Province Archives, St. Louis, MO, 1995, unknown\nFaherty, S. J., William Barnaby, U. S Catholic Historian, Jesuit Missouri Province Archives, St. Louis, MO, Summer 1995, unknown\nMach, Andrew, American Catholic Studies, Van Allen, Rodger, American Catholic Studies\nMorris, Claire, 69th New York & It's Place in The Irish Brigade, 2006, 25\nO'Beirne, Kevin, Military Heritage, Octtober 1999, 40-41\nRable, George C., Civil War Times, Civil War Times, North Carolina, December 2003, 56-59, 86-88\nShattuck, Gardiner H., The Sword of the Lord: , Bergen, Doris, University of Notre Dame Press, Notre Dame, IN, 2004, 105-123, illustrated on pg. 113\nSymonds, Craig L., American Heritage History of the Battle of Gettysburg, HarperCollins , North America, 2001, unknown\n"], ['', '', '', '', '', '', '', '', 'Key words', 'confederate\nbattle\ncivil war\npriest\nbattlefield\nirish\nsoldier\nconflict\nAAT:<Associated Concepts Facet>:<Associated Concepts>:<religions and religious concepts>:<religious concepts>:<doctrinal concepts>:absolution\nAAT:<Physical Attributes Facet>:<Attributes and Properties>:<attributes and properties>:<attributes and properties by specific type>:<positional attributes>:compass points:north\nAAT:<Styles and Periods Facet>:<Styles and Periods>:<styles and periods by region>:<The Americas>:<American regions>:South American\nAAT:<Activities Facet>:<Events>:events:armed conflicts\nAAT:<Activities Facet>:<Events>:events:armed conflicts:wars\nAAT:<Activities Facet>:<Events>:events:armed conflicts:wars:civil wars\nAAT:<Objects Facet>:Visual and Verbal Communication:<Visual Works (Hierarchy Name)>:<visual works (Guide Term)>:<visual works by form>:<visual works by form: image form>:depictions\nAAT:<Objects Facet>:Visual and Verbal Communication:<Information Forms (Hierarchy Name)>:<information forms (Guide Term)>:<document genres>:<document genres by form>:<document genres for literary works>:poems:<poems by function>:epics\n']]
        self.assertTrue(lines == expected_csv)

        #verify one pnx
        embark_xml_doc = ElementTree(file='temp/pnx/1976.057.xml')
        expected_xml_result = b'<records xmlns:ns0="http://www.exlibrisgroup.com/xsd/primo/primo_nm_bib"><ns0:record><ns0:id>1976.057</ns0:id><ns0:display><ns0:lds02>1976.057</ns0:lds02><ns0:title>ABSOLUTION UNDER FIRE</ns0:title><ns0:creator>Paul Wood</ns0:creator><ns0:creationdate>1891</ns0:creationdate><ns0:format>oil on canvas, 76 1/2 x 102 x 3 1/4 in. (194.31 x 259.08 x 8.26 cm)</ns0:format><ns0:lds09>painting</ns0:lds09><ns0:type>painting</ns0:type><ns0:lsd10>Snite</ns0:lsd10><ns0:subject>confederate</ns0:subject><ns0:subject>battle</ns0:subject><ns0:subject>civil war</ns0:subject><ns0:subject>priest</ns0:subject><ns0:subject>battlefield</ns0:subject><ns0:subject>irish</ns0:subject><ns0:subject>soldier</ns0:subject><ns0:subject>conflict</ns0:subject><ns0:subject>AAT:&lt;Associated Concepts Facet&gt;:&lt;Associated Concepts&gt;:&lt;religions and religious concepts&gt;:&lt;religious concepts&gt;:&lt;doctrinal concepts&gt;:absolution</ns0:subject><ns0:subject>AAT:&lt;Physical Attributes Facet&gt;:&lt;Attributes and Properties&gt;:&lt;attributes and properties&gt;:&lt;attributes and properties by specific type&gt;:&lt;positional attributes&gt;:compass points:north</ns0:subject><ns0:subject>AAT:&lt;Styles and Periods Facet&gt;:&lt;Styles and Periods&gt;:&lt;styles and periods by region&gt;:&lt;The Americas&gt;:&lt;American regions&gt;:South American</ns0:subject><ns0:subject>AAT:&lt;Activities Facet&gt;:&lt;Events&gt;:events:armed conflicts</ns0:subject><ns0:subject>AAT:&lt;Activities Facet&gt;:&lt;Events&gt;:events:armed conflicts:wars</ns0:subject><ns0:subject>AAT:&lt;Activities Facet&gt;:&lt;Events&gt;:events:armed conflicts:wars:civil wars</ns0:subject><ns0:subject>AAT:&lt;Objects Facet&gt;:Visual and Verbal Communication:&lt;Visual Works (Hierarchy Name)&gt;:&lt;visual works (Guide Term)&gt;:&lt;visual works by form&gt;:&lt;visual works by form: image form&gt;:depictions</ns0:subject><ns0:subject>AAT:&lt;Objects Facet&gt;:Visual and Verbal Communication:&lt;Information Forms (Hierarchy Name)&gt;:&lt;information forms (Guide Term)&gt;:&lt;document genres&gt;:&lt;document genres by form&gt;:&lt;document genres for literary works&gt;:poems:&lt;poems by function&gt;:epics</ns0:subject><ns0:lds01>Bilby, Joseph G., Remember Fontenoy!, Longstreet House, Highstown, NJ, 1995, 86</ns0:lds01><ns0:lds01>Burger, John, Columbia, Pelowski, Alton J., Knights of Columbus, New Haven, CT, May 2015, 16-18</ns0:lds01><ns0:lds01>Callaghan, James, Civil War, Miller, William J., Christopher M. Curran, Berryville, VA, August 1997, 26-33</ns0:lds01><ns0:lds01>Carey, John E., The Civil War, The Washington Times, Saturday, Sept. 14, 1996, B3-not illustrated</ns0:lds01><ns0:lds01>Clark, Champ, The Civil War, Time Life Books, 1985, 100-101</ns0:lds01><ns0:lds01>Corby, William, Memoirs of Chaplain Life, Kohl, Lawrence Frederick, Fordham University Press, Chicago, 1893, 385-387</ns0:lds01><ns0:lds01>Faherty, S. J., William Barnaby, Catholic Chaplains in Blue and Gray, Jesuit Missouri Province Archives, St. Louis, MO, 1995, unknown</ns0:lds01><ns0:lds01>Faherty, S. J., William Barnaby, U. S Catholic Historian, Jesuit Missouri Province Archives, St. Louis, MO, Summer 1995, unknown</ns0:lds01><ns0:lds01>Mach, Andrew, American Catholic Studies, Van Allen, Rodger, American Catholic Studies</ns0:lds01><ns0:lds01>Morris, Claire, 69th New York &amp; It\'s Place in The Irish Brigade, 2006, 25</ns0:lds01><ns0:lds01>O\'Beirne, Kevin, Military Heritage, Octtober 1999, 40-41</ns0:lds01><ns0:lds01>Rable, George C., Civil War Times, Civil War Times, North Carolina, December 2003, 56-59, 86-88</ns0:lds01><ns0:lds01>Shattuck, Gardiner H., The Sword of the Lord: , Bergen, Doris, University of Notre Dame Press, Notre Dame, IN, 2004, 105-123, illustrated on pg. 113</ns0:lds01><ns0:lds01>Symonds, Craig L., American Heritage History of the Battle of Gettysburg, HarperCollins , North America, 2001, unknown</ns0:lds01><ns0:contributor>Picturing History (09/01/94 - 12/01/94)</ns0:contributor></ns0:display><ns0:search><ns0:recordid>1976.057</ns0:recordid><ns0:title>ABSOLUTION UNDER FIRE</ns0:title><ns0:creator>Paul Wood</ns0:creator><ns0:creationdate>18910101</ns0:creationdate><ns0:general>oil on canvas, 76 1/2 x 102 x 3 1/4 in. (194.31 x 259.08 x 8.26 cm)</ns0:general><ns0:lsr09>painting</ns0:lsr09><ns0:rsrctype>painting</ns0:rsrctype><ns0:scope>SNITE</ns0:scope><ns0:subject>confederate</ns0:subject><ns0:subject>battle</ns0:subject><ns0:subject>civil war</ns0:subject><ns0:subject>priest</ns0:subject><ns0:subject>battlefield</ns0:subject><ns0:subject>irish</ns0:subject><ns0:subject>soldier</ns0:subject><ns0:subject>conflict</ns0:subject><ns0:subject>AAT:&lt;Associated Concepts Facet&gt;:&lt;Associated Concepts&gt;:&lt;religions and religious concepts&gt;:&lt;religious concepts&gt;:&lt;doctrinal concepts&gt;:absolution</ns0:subject><ns0:subject>AAT:&lt;Physical Attributes Facet&gt;:&lt;Attributes and Properties&gt;:&lt;attributes and properties&gt;:&lt;attributes and properties by specific type&gt;:&lt;positional attributes&gt;:compass points:north</ns0:subject><ns0:subject>AAT:&lt;Styles and Periods Facet&gt;:&lt;Styles and Periods&gt;:&lt;styles and periods by region&gt;:&lt;The Americas&gt;:&lt;American regions&gt;:South American</ns0:subject><ns0:subject>AAT:&lt;Activities Facet&gt;:&lt;Events&gt;:events:armed conflicts</ns0:subject><ns0:subject>AAT:&lt;Activities Facet&gt;:&lt;Events&gt;:events:armed conflicts:wars</ns0:subject><ns0:subject>AAT:&lt;Activities Facet&gt;:&lt;Events&gt;:events:armed conflicts:wars:civil wars</ns0:subject><ns0:subject>AAT:&lt;Objects Facet&gt;:Visual and Verbal Communication:&lt;Visual Works (Hierarchy Name)&gt;:&lt;visual works (Guide Term)&gt;:&lt;visual works by form&gt;:&lt;visual works by form: image form&gt;:depictions</ns0:subject><ns0:subject>AAT:&lt;Objects Facet&gt;:Visual and Verbal Communication:&lt;Information Forms (Hierarchy Name)&gt;:&lt;information forms (Guide Term)&gt;:&lt;document genres&gt;:&lt;document genres by form&gt;:&lt;document genres for literary works&gt;:poems:&lt;poems by function&gt;:epics</ns0:subject><ns0:creatorcontrib>Picturing History (09/01/94 - 12/01/94)</ns0:creatorcontrib></ns0:search><ns0:browse><ns0:title>ABSOLUTION UNDER FIRE</ns0:title><ns0:author>Paul Wood</ns0:author><ns0:institution>SNITE</ns0:institution></ns0:browse><ns0:sort><ns0:title>ABSOLUTION UNDER FIRE</ns0:title><ns0:author>Paul Wood</ns0:author><ns0:creationdate>18910101</ns0:creationdate></ns0:sort><ns0:facet><ns0:creatorcontrib>Paul Wood</ns0:creatorcontrib><ns0:lfc09>painting</ns0:lfc09><ns0:rsrctype>painting</ns0:rsrctype><ns0:library>SNITE</ns0:library><ns0:creationdate>18910101</ns0:creationdate><ns0:topic>confederate</ns0:topic><ns0:topic>battle</ns0:topic><ns0:topic>civil war</ns0:topic><ns0:topic>priest</ns0:topic><ns0:topic>battlefield</ns0:topic><ns0:topic>irish</ns0:topic><ns0:topic>soldier</ns0:topic><ns0:topic>conflict</ns0:topic><ns0:topic>AAT:&lt;Associated Concepts Facet&gt;:&lt;Associated Concepts&gt;:&lt;religions and religious concepts&gt;:&lt;religious concepts&gt;:&lt;doctrinal concepts&gt;:absolution</ns0:topic><ns0:topic>AAT:&lt;Physical Attributes Facet&gt;:&lt;Attributes and Properties&gt;:&lt;attributes and properties&gt;:&lt;attributes and properties by specific type&gt;:&lt;positional attributes&gt;:compass points:north</ns0:topic><ns0:topic>AAT:&lt;Styles and Periods Facet&gt;:&lt;Styles and Periods&gt;:&lt;styles and periods by region&gt;:&lt;The Americas&gt;:&lt;American regions&gt;:South American</ns0:topic><ns0:topic>AAT:&lt;Activities Facet&gt;:&lt;Events&gt;:events:armed conflicts</ns0:topic><ns0:topic>AAT:&lt;Activities Facet&gt;:&lt;Events&gt;:events:armed conflicts:wars</ns0:topic><ns0:topic>AAT:&lt;Activities Facet&gt;:&lt;Events&gt;:events:armed conflicts:wars:civil wars</ns0:topic><ns0:topic>AAT:&lt;Objects Facet&gt;:Visual and Verbal Communication:&lt;Visual Works (Hierarchy Name)&gt;:&lt;visual works (Guide Term)&gt;:&lt;visual works by form&gt;:&lt;visual works by form: image form&gt;:depictions</ns0:topic><ns0:topic>AAT:&lt;Objects Facet&gt;:Visual and Verbal Communication:&lt;Information Forms (Hierarchy Name)&gt;:&lt;information forms (Guide Term)&gt;:&lt;document genres&gt;:&lt;document genres by form&gt;:&lt;document genres for literary works&gt;:poems:&lt;poems by function&gt;:epics</ns0:topic></ns0:facet><ns0:delivery><ns0:delcategory>Physical Item</ns0:delcategory><ns0:institution>SNITE</ns0:institution></ns0:delivery></ns0:record></records>'
        self.assertTrue(tostring(embark_xml_doc.getroot()) == expected_xml_result)

if __name__ == '__main__':
    unittest.main()
